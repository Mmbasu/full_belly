{% extends "users/registration_base.html" %}

{% block title %}Register{% endblock %}

{% block content %}

<section class="py-36">
  <div class="container px-4 mx-auto">
    <div class="relative max-w-lg mx-auto pt-16 pb-16 px-6 md:px-10 lg:px-16 rounded-xl border-2" style="background-color: #ffffff; border-color: #2BA19A;">
      <a class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2" href="#">
        <img class="block" src="https://i.ibb.co/wKwTF3T/Screenshot-from-2023-03-18-08-54-04.png" alt="Screenshot-from-2023-03-18-08-54-04" width="130" style="border: 2px solid #ADD8E6; border-radius: 0.5rem;">
      </a>
      <div class="relative max-w-md mx-auto">
        <div class="text-center mb-6">
          <h2 class="text-4xl text-dark font-semibold mb-2 mt-4">SignUp</h2>
            <p class="text-gray-500 font-medium mb-6 mt-4">Start Your journey with us</p>
        </div>

<form id="register-form" method="post" action="{% url 'users:register' %}">
  {% csrf_token %}

  <!-- Email Input -->
<div class="w-full md:flex-1 p-3 relative py-4 px-3 border-gray-400">
  <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg border border-gray-400 focus:border-green-500" placeholder="E-mail address" type="email" name="email">
  <div id="email-error" class="text-red-500 text-sm mt-1 error-message"></div>
</div>

  <!-- Username Input -->
<div class="w-full md:flex-1 p-3 relative py-4 px-3 border-gray-400">
  <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg border border-gray-400 focus:border-green-500" placeholder="Username" type="text" name="username">
  <div id="username-error" class="text-red-500 text-sm mt-1 error-message"></div>
</div>

<!-- Phone Input -->
<div class="w-full md:flex-1 p-3 relative py-4 px-3 border-gray-400">
  <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg border border-gray-400 focus:border-green-500" placeholder="Phone Number" type="text" name="phone">
  <div id="phone-error" class="text-red-500 text-sm mt-1 error-message"></div>
</div>

<!-- First Name Input -->
<div class="w-full md:flex-1 p-3 relative py-4 px-3 border-gray-400">
  <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg border border-gray-400 focus:border-green-500" placeholder="First Name" type="text" name="first_name">
  <div id="first_name-error" class="text-red-500 text-sm mt-1 error-message"></div>
</div>

<!-- Last Name Input -->
<div class="w-full md:flex-1 p-3 relative py-4 px-3 border-gray-400">
  <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg border border-gray-400 focus:border-green-500" placeholder="Last Name" type="text" name="last_name">
  <div id="last_name-error" class="text-red-500 text-sm mt-1 error-message"></div>
</div>

<!-- Password1 Input -->
<div class="w-full md:flex-1 p-3 relative py-4 px-3 border-gray-400">
  <div class="flex items-center">
    <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg border border-gray-400 focus:border-green-500" placeholder="Password" type="password" name="password1" autocomplete="new-password" id="password-input">
    <button class="btn btn-outline-danger ml-4 toggle-password" type="button">
      <i class="fa-solid fa-eye-slash"></i>
    </button>
  </div>
  <div id="password1-error" class="text-red-500 text-sm mt-1 error-message"></div>
</div>

<!-- Password2 Input -->
<div class="w-full md:flex-1 p-3 relative py-4 px-3 border-gray-400">
  <div class="flex items-center">
    <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg border border-gray-400 focus:border-green-500" placeholder="Confirm password" type="password" name="password2">
    <button class="btn btn-outline-danger ml-4 toggle-password" type="button">
      <i class="fa-solid fa-eye-slash"></i>
    </button>
  </div>
  <div id="password2-error" class="text-red-500 text-sm mt-1 error-message"></div>
</div>

<!-- Role Input -->
<div class="w-full md:flex-1 p-3 relative py-4 px-3 border-gray-400">
  <div class="flex items-center">
    <select class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg border border-gray-400 focus:border-green-500" name="role" id="role">
      <option value="">Select role</option>
      <option value="donor">Donor</option>
      <option value="recipient">Recipient</option>
    </select>
  </div>
  <div id="role-error" class="text-red-500 text-sm mt-1 error-message"></div>
</div>

  <button id="register-button" class="group relative font-semibold leading-6 px-6 mt-4 py-5 w-full uppercase text-white text-xs font-semibold tracking-px bg-custom-color hover:bg-custom-hover overflow-hidden rounded-md" type="submit">
    <div class="absolute top-0 left-0 transform -translate-x-full group-hover:-translate-x-0 h-full w-full transition ease-in-out duration-500 bg-gradient-custom"></div>
    <p class="relative z-10">Create account</p>
  </button>

  <p class="font-medium text-center mt-4">
    <span class="text-gray-500">Already have an account?</span>
    <a class="inline-block text-blue-500 hover:underline" style="color: #AF8905" href="{% url 'users:login' %}">Sign In</a>
  </p>
</form>





      </div>
    </div>
  </div>
</section>


<script>
  // Function to create a modal with the given message and heading
  function createModal(message, heading) {
    const modal = document.createElement('div');
    modal.classList.add('modal', 'fixed', 'inset-0', 'flex', 'items-center', 'justify-center', 'bg-gray-800', 'bg-opacity-50', 'z-50');
    modal.innerHTML = `
      <div class="modal-content modal-large">
        <div><i class="fa-solid fa-circle-check fa-beat-fade fa-2xl" style="margin-top: 20px; margin-bottom: 30px; color: #2BA19A;"></i></div>
        <h2 class="mb-2 text-2xl lg:text-2xl font-bold font-heading" style="color: #2BA19A;">${heading}</h2>
        <p>${message}</p>
      </div>
    `;
    return modal;
  }

  // Function to show the success modal
  function showSuccessModal() {
    const successModal = createModal('Account created successfully. Check your email for an activation link.', 'Success');
    document.body.appendChild(successModal);

    // Hide the success modal after a few seconds (adjust the timeout as needed)
    setTimeout(() => {
      document.body.removeChild(successModal);
    }, 5000); // Hide after 5 seconds (5000 milliseconds)
  }

  // Function to create and show the loading modal
  function showLoadingModal() {
    const loadingModal = createModal('Please wait while we process your request.', 'Loading...');
    document.body.appendChild(loadingModal);
  }

  // Function to hide the loading modal
  function hideLoadingModal() {
    const loadingModal = document.querySelector('.modal');
    if (loadingModal) {
      document.body.removeChild(loadingModal);
    }
  }

  // Get the form element
  const newsletterForm = document.getElementById('newsletter-form');

  // Add a submit event listener to the form
  newsletterForm.addEventListener('submit', async (e) => {
    e.preventDefault(); // Prevent the default form submission

    // Get the email input field and error message div
    const emailInput = document.getElementById('id_email');
    const emailError = document.getElementById('email-error');

    // Clear any previous error messages
    emailError.textContent = '';

    // Get the email value from the input field
    const email = emailInput.value;

    // Show the loading modal while waiting for the response
    showLoadingModal();

    // Create a FormData object to send the data to the server
    const formData = new FormData();
    formData.append('email', email);

    try {
      // Send a POST request to the server
      const response = await fetch(newsletterForm.action, {
        method: 'POST',
        body: formData,
        headers: {
          'X-CSRFToken': '{{ csrf_token }}', // Include the CSRF token
        },
      });

      // Hide the loading modal when the response is received
      hideLoadingModal();

      // Parse the JSON response
      const data = await response.json();

      // Check if there are errors
      if (data.errors) {
        // Display the error message under the email input field
        emailError.textContent = data.errors.email;
      } else if (data.success) {
        // Show the success modal when the server indicates success
        showSuccessModal();
      }
    } catch (error) {
      console.error('Error:', error);
    }
  });
</script>




{% endblock content %}
