{% extends "recipient/fullbellybase.html" %}

{% block title %}Drivers{% endblock %}

{% block content %}

    <div class="p-6 border border-coolGray-100 overflow-hidden bg-white rounded-md shadow-dashboard relative">
      <div class="pb-6 border-b border-coolGray-100">
        <div class="flex flex-wrap items-center justify-between -m-2">
          <div class="w-full md:w-auto">
            <section>
              <div class="bg-white">
                <div class="container px-4 mx-auto">
                  <div class="flex flex-wrap h-16 py-4 items-center">
                    <p class="inline-block text-xl text-coolGray-500 font-medium">Recipient</p>
                    <span class="mx-3">
                      <i class="fa-solid fa-caret-right"></i>
                    </span>
                    <p class="inline-block text-xl text-coolGray-500 font-medium">Drivers</p>
                    <span class="mx-3">
                      <i class="fa-solid fa-caret-right"></i>
                    </span>
                    <p class="inline-block text-xl text-greenish font-medium hover:bg-transparent">Create Driver Account</p>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>

      <form id="add-driver-form" method="post" action="{% url 'recipient:add_driver' %}" enctype="multipart/form-data">
        {% csrf_token %}
<section class="bg-coolGray-50 py-4">
  <div class="container px-4 mx-auto">
    <div class="p-6 h-full border border-coolGray-100 overflow-hidden bg-white rounded-md shadow-dashboard">
      <div class="pb-6 border-b border-coolGray-100">
        <div class="flex flex-wrap items-center justify-between -m-2">
          <div class="w-full md:w-auto p-2">
            <p class="text-lg text-coolGray-500 font-medium">Fill in the details below</p>
          </div>
          <div class="flex justify-end space-x-4 mt-8">
          <button class="group relative font-medium leading-6 px-4 py-3 w-32 uppercase text-white text-xs font-semibold tracking-px bg-custom-color overflow-hidden rounded-md" onclick="window.location.href='{% url 'recipient:drivers' %}'">
            <div class="absolute top-0 left-0 transform -translate-x-full group-hover:-translate-x-0 h-full w-full transition ease-in-out duration-500 bg-gradient-custom-3"></div>
            <p class="relative z-10">Cancel</p>
          </button>

          <button id="add-driver-button" class="group relative font-semibold leading-6 px-4 py-3 w-32 uppercase text-white text-xs font-semibold tracking-px bg-custom-color hover:bg-custom-hover overflow-hidden rounded-md" type="submit">
            <div class="absolute top-0 left-0 transform -translate-x-full group-hover:-translate-x-0 h-full w-full transition ease-in-out duration-500 bg-gradient-custom"></div>
            <p class="relative z-10">Add Driver</p>
          </button>
        </div>
        </div>
      </div>

        <div class="mt-4"></div>

        <!-- Email Field -->
        <div class="relative w-full py-2 px-3 mb-4 border-gray-400 focus-within:border-green-500 rounded-lg">
          <div class="flex items-center">
            <label for="id_Email" class="block w-1/4 pr-4 font-medium text-sm text-gray-700">Email</label>
            <div class="w-1/2">
              <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg" type="email" name="Email" id="id_Email" data-field-name="Email" placeholder="eg, example@gmail.com">
            </div>
          </div>
          <div id="Email-error" class="text-red-500 text-sm error-message"></div>
        </div>

        <!-- Username Field -->
        <div class="relative w-full py-2 px-3 mb-4 border-gray-400 focus-within:border-green-500 rounded-lg">
          <div class="flex items-center">
            <label for="id_Username" class="block w-1/4 pr-4 font-medium text-sm text-gray-700">Username</label>
            <div class="w-1/2">
              <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg" type="text" name="Username" id="id_Username" data-field-name="Username" placeholder="eg, driver_1">
            </div>
          </div>
          <div id="Username-error" class="text-red-500 text-sm error-message"></div>
        </div>

        <!-- First Name Field -->
        <div class="relative w-full py-2 px-3 mb-4 border-gray-400 focus-within:border-green-500 rounded-lg">
          <div class="flex items-center">
            <label for="id_first_name" class="block w-1/4 pr-4 font-medium text-sm text-gray-700">First Name</label>
            <div class="w-1/2">
              <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg" type="text" name="first_name" id="id_first_name" data-field-name="first_name" placeholder="eg, John">
            </div>
          </div>
          <div id="first_name-error" class="text-red-500 text-sm error-message"></div>
        </div>

        <!-- Last Name Field -->
        <div class="relative w-full py-2 px-3 mb-4 border-gray-400 focus-within:border-green-500 rounded-lg">
          <div class="flex items-center">
            <label for="id_last_name" class="block w-1/4 pr-4 font-medium text-sm text-gray-700">Last Name</label>
            <div class="w-1/2">
              <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg" type="text" name="last_name" id="id_last_name" data-field-name="last_name" placeholder="eg, Doe">
            </div>
          </div>
          <div id="last_name-error" class="text-red-500 text-sm error-message"></div>
        </div>

        <!-- Phone Field -->
        <div class="relative w-full py-2 px-3 mb-4 border-gray-400 focus-within:border-green-500 rounded-lg">
          <div class="flex items-center">
            <label for="id_Phone" class="block w-1/4 pr-4 font-medium text-sm text-gray-700">Phone</label>
            <div class="w-1/2">
              <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg" type="text" name="phone" id="id_phone" data-field-name="phone" placeholder="eg, 0712345678">
            </div>
          </div>
          <div id="phone-error" class="text-red-500 text-sm error-message"></div>
        </div>

        <!-- Profile Photo Field -->
        <div class="relative w-full py-2 px-3 mb-4 border-gray-400 focus-within:border-green-500 rounded-lg">
          <div class="w-full md:w-9/12">
            <div class="flex flex-wrap -m-3" id="photo-section">
              <div class="w-full md:w-1/3 p-3">
                <p class="text-sm text-gray-700 font-semibold">Profile Photo</p>
              </div>
              <div class="flex flex-wrap items-center -m-3">
                <div class="w-auto p-3">
                  <img class="relative w-32 h-32 mb-4 mx-auto rounded-full object-cover object-right" src="{{ form.photo.value.url }}" alt="{{ form.photo.value.name }}">
                </div>
                <div class="w-auto p-3">
                  <button id="change-photo-btn" class="group relative font-medium leading-6 px-5 mb-2 py-3 w-full uppercase text-white text-xs font-semibold tracking-px bg-custom-color hover:bg-custom-hover overflow-hidden rounded-md">
                    <div class="absolute top-0 left-0 transform -translate-x-full group-hover:-translate-x-0 h-full w-full transition ease-in-out duration-500 bg-gradient-custom"></div>
                    <p class="relative z-10">Change</p>
                  </button>
                </div>
              </div>
            </div>
            <div class="flex flex-wrap -m-3 hidden" id="upload-photo-section">
              <div class="w-full md:w-1/3 p-3">
                <label for="id_Photo" class="block w-1/4 pr-4 font-medium text-sm text-gray-700">Profile Photo</label>
                <p class="text-xs text-gray-700 font-medium">Upload photo</p>
              </div>
              <div class="w-full md:flex-1 p-3">
                <div class="relative flex flex-col items-center justify-center p-6 h-44 text-center text-greenish focus-within:border-greenish border border-dashed border-coolGray-200 rounded-lg">
                  <input class="block w-full p-6 h-44 bg-transparent text-sm text-center text-greenish font-medium rounded-lg focus-within:border-greenish border border-dashed border-greenish rounded-lg" type="file" name="photo" id="id_photo" accept="image/*" data-field-name="photo">
                  <div id="photo-error" class="text-red-500 text-sm error-message"></div>
                </div>
              </div>
              <div class="w-full md:w-auto p-1.5">
                <button id="cancel-photo-btn" class="group relative font-medium leading-6 px-5 mb-2 py-3 w-full uppercase text-white text-xs font-semibold tracking-px bg-custom-color overflow-hidden rounded-md">
                  <div class="absolute top-0 left-0 transform -translate-x-full group-hover:-translate-x-0 h-full w-full transition ease-in-out duration-500 bg-gradient-custom-3"></div>
                  <p class="relative z-10">Cancel</p>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Driver ID Number Field -->
        <div class="relative w-full py-2 px-3 mb-4 border-gray-400 focus-within:border-green-500 rounded-lg">
          <div class="flex items-center">
            <label for="id_DriverIDNumber" class="block w-1/4 pr-4 font-medium text-sm text-gray-700">Driver ID Number</label>
            <div class="w-1/2">
              <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg" type="text" name="DriverIDNumber" id="id_DriverIDNumber" data-field-name="DriverIDNumber" placeholder="eg, 12345678">
            </div>
          </div>
          <div id="DriverIDNumber-error" class="text-red-500 text-sm error-message"></div>
        </div>

        <!-- Driving License Number Field -->
        <div class="relative w-full py-2 px-3 mb-4 border-gray-400 focus-within:border-green-500 rounded-lg">
          <div class="flex items-center">
            <label for="id_DrivingLicenseNumber" class="block w-1/4 pr-4 font-medium text-sm text-gray-700">Driving License Number</label>
            <div class="w-1/2">
              <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg" type="text" name="DrivingLicenseNumber" id="id_DrivingLicenseNumber" data-field-name="DrivingLicenseNumber" placeholder="eg, DL-1234567">
            </div>
          </div>
          <div id="DrivingLicenseNumber-error" class="text-red-500 text-sm error-message"></div>
        </div>

        <!-- Car Number Plate Field -->
        <div class="relative w-full py-2 px-3 mb-4 border-gray-400 focus-within:border-green-500 rounded-lg">
          <div class="flex items-center">
            <label for="id_CarNumberPlate" class="block w-1/4 pr-4 font-medium text-sm text-gray-700">Car Number Plate</label>
            <div class="w-1/2">
              <input class="block w-full h-14 bg-transparent text-sm text-dark font-medium rounded-lg" type="text" name="CarNumberPlate" id="id_CarNumberPlate" data-field-name="CarNumberPlate" placeholder="eg, KAY 456 B">
            </div>
          </div>
          <div id="CarNumberPlate-error" class="text-red-500 text-sm error-message"></div>
        </div>
    </div>
  </div>
</section>
</form>

<script>
  $(document).ready(function() {
  // Toggle password visibility
  const togglePasswordButtons = document.querySelectorAll('.toggle-password');
  togglePasswordButtons.forEach(button => {
    button.addEventListener('click', () => {
      const passwordInput = button.previousElementSibling;
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      button.innerHTML = type === 'password' ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
    });
  });

  $('#add-driver-form').submit(function(event) {
    event.preventDefault();

    var formData = new FormData(this);  // Use FormData to include file input field

    $.ajax({
      type: 'POST',
      url: '{% url "recipient:add_driver" %}',
      data: formData,
      dataType: 'json',
      contentType: false,  // Set contentType and processData to false when using FormData
      processData: false,
      beforeSend: function() {
        // Show loading modal
        $('#loading-popup').removeClass('hidden');
      },
      success: function(response) {
        if (response.success) {
          // Hide loading modal
          $('#loading-popup').addClass('hidden');

          // Show success modal
          $('#success-popup').removeClass('hidden');

          // Redirect to desired page after a delay
          setTimeout(function() {
            window.location.href = '{% url "recipient:drivers" %}';
          }, 3000);
        } else {
          // Hide success modal if it's shown for any previous registration attempt
          $('#success-popup').addClass('hidden');

          // Clear previous errors
          $('.text-red-500').html('');

          // Handle form errors
          var errors = response.errors;
          for (var field in errors) {
            var errorMessages = errors[field].join('<br>');
            $('#' + field + '-error').html('<span>' + errorMessages + '</span>');
          }
        }
      },
      error: function(error) {
        console.error(error);
      },
      complete: function() {
        // Hide loading modal
        $('#loading-popup').addClass('hidden');
      }
    });
  });
});


</script>
    </div>


{% endblock content %}